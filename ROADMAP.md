# IPv6 工具箱 - 产品路线图

## 项目概述
IPv6 工具箱是一个跨平台（Android、iOS、Windows、Linux、macOS）应用，基于 Kotlin Multiplatform (KMP) + Compose Multiplatform 开发，旨在为网络工程师、开发者和 IPv6 用户提供完整的 IPv6 网络工具集。

---

## 版本规划

### v0.1.0 - MVP（最小可行产品）🎯 优先级：P0 ✅ 核心功能已实现（2025-10-26）
**目标：** 建立基础架构，实现核心 IPv6 工具功能  
**首发平台：** Android（完整）、Desktop（完整）、iOS（实验性）  
**当前状态：** 85% 完成，核心代码已实现，待编译调试和集成

#### 核心功能

##### IPv6 地址解析与验证 ✅ 跨平台完整支持 **已实现**
- [x] IPv6 地址格式验证（正则 + RFC 规则）
- [x] IPv6 地址展开/压缩转换
- [x] IPv6 地址类型识别（Link-Local、Global、ULA、Multicast 等）
- [x] IPv6 前缀计算与 CIDR 解析
- [x] **测试要求：** commonTest 覆盖率 > 80%，包含金样本测试用例

##### 基础网络诊断工具 ⚠️ 平台差异显著 **已实现**
- [x] **Ping6（ICMPv6 Echo Request）**
  - **Android：** ✅ 使用 `/system/bin/ping6` 命令
  - **Desktop：** ✅ 使用 JVM ProcessBuilder 调用系统 ping6 命令（支持 Windows/Linux/macOS）
  - **iOS：** ✅ **降级实现** - 使用 TCP 连接性检查（端口 80/443）或 NSURLSession

- [x] **Traceroute6（路径追踪）**
  - **Android：** ✅ 使用系统 traceroute6 命令
  - **Desktop：** ✅ 调用系统 traceroute6/tracert（跨平台命令适配）
  - **iOS：** ❌ **暂不实现**，标注"平台不支持"

- [x] **TCP 连接性测试**（所有平台）
  - ✅ 指定 IPv6 地址和端口的 TCP 连接探测
  - ✅ 超时检测、连接时间测量
  - ✅ 作为 iOS 平台的主要诊断工具

##### 网络层抽象架构 🏗️ 技术债务预防 **已实现**
- [x] **expect/actual 网络抽象层设计**
  - ✅ `interface NetworkDiagnostics` 定义通用接口
  - ✅ 各平台 actual 实现：`AndroidNetworkDiagnostics`, `IosNetworkDiagnostics`, `DesktopNetworkDiagnostics`
  - ✅ 能力协商机制：平台声明支持的功能集（`PlatformCapabilities`）
  - ✅ 降级策略：不支持功能返回明确的错误类型

- [x] **网络诊断模块建立**
  - ✅ `commonMain`：接口定义、数据模型、Result 封装
  - ✅ 各平台 Main：平台实现（Android/iOS/Desktop）
  - ✅ 统一错误处理（`NetworkDiagnosticError`）

##### UI 框架 **已实现**
- [x] 主界面导航架构（底部导航栏）
- [x] Material 3 主题系统
- [x] 深色/浅色模式支持
- [x] 基础响应式布局

##### 跨平台适配 **已实现**
- [x] Android 平台基础实现（minSdk 24）
- [x] Desktop（JVM）平台基础实现（Java 11+）
- [x] iOS 平台基础实现（标注功能限制）

##### 测试与质量保障 **部分完成**
- [x] IPv6 地址处理单元测试（commonTest）
- [x] 子网计算器单元测试（commonTest）
- [ ] Android 网络功能集成测试（仪器测试）**待实现**
- [ ] Desktop 运行配置与手动测试 **待实现**

**平台功能覆盖矩阵：**
| 功能 | Android | iOS | Desktop |
|------|---------|-----|---------|
| IPv6 地址处理 | ✅ 完整 | ✅ 完整 | ✅ 完整 |
| Ping6 (ICMP) | ✅ 完整 | ⚠️ TCP 探测 | ✅ 完整 |
| Traceroute6 | ✅ 完整 | ❌ 不支持 | ✅ 完整 |
| TCP 连接测试 | ✅ 完整 | ✅ 完整 | ✅ 完整 |

**交付时间：** 6-8 周（调整 +2 周用于网络抽象层与测试）

---

### v0.2.0 - 增强工具集 🔧 优先级：P0
**目标：** 扩展网络诊断和分析功能  
**平台策略：** 优先保证 Android + Desktop 完整性

#### 新增功能

##### DNS 工具 🌐 跨平台统一实现
- [ ] **IPv6 DNS 查询（AAAA 记录）**
  - **统一方案：** 使用 DNS over HTTPS (DoH) 作为跨平台实现
    - Google Public DNS: `https://dns.google/resolve`
    - Cloudflare: `https://cloudflare-dns.com/dns-query`
  - **备用方案（Android/Desktop）：** 系统原生 DNS 解析器
  - **iOS：** 仅 DoH 方案，系统解析器受限

- [ ] **PTR 反向查询**（DoH 支持）
- [ ] **DNS 服务器配置**
  - DoH 服务器选择（预设 + 自定义）
  - ⚠️ **iOS 限制：** 仅应用内配置，不修改系统 DNS

- [ ] **查询历史记录**（SQLDelight）

##### 网络信息查看 📡 平台差异化实现
- [ ] **本机 IPv6 地址列表**
  - **Android：** NetworkInterface API
  - **Desktop：** NetworkInterface API
  - **iOS：** ⚠️ **受限实现** - 仅能获取当前连接的地址，无法枚举所有接口

- [ ] **网络接口信息**
  - **Android/Desktop：** 完整接口列表、MAC 地址、MTU
  - **iOS：** ⚠️ **基础信息** - 接口名、IPv6 地址、状态

- [ ] **默认路由信息**
  - **Android/Desktop：** 路由表解析
  - **iOS：** ⚠️ **暂不支持**，仅显示网关可达性

- [ ] **IPv6 连接状态检测**（所有平台）

##### 子网计算器 🧮 跨平台完整支持
- [ ] IPv6 子网划分（支持任意前缀长度）
- [ ] CIDR 计算与验证
- [ ] 地址范围计算（起始/结束地址）
- [ ] 子网可视化（树状/列表展示）
- [ ] **测试要求：** commonTest 覆盖率 > 85%

##### 数据持久化
- [ ] 本地数据库集成（SQLDelight，跨平台）
- [ ] 工具使用历史（DNS 查询、Ping 结果等）
- [ ] 收藏夹功能（地址、域名收藏）
- [ ] 数据库迁移策略

**平台功能覆盖矩阵：**
| 功能 | Android | iOS | Desktop |
|------|---------|-----|---------|
| DNS 查询 (DoH) | ✅ 完整 | ✅ 完整 | ✅ 完整 |
| 系统 DNS 解析 | ✅ 支持 | ❌ 不支持 | ✅ 支持 |
| 本机地址列表 | ✅ 完整 | ⚠️ 受限 | ✅ 完整 |
| 网络接口信息 | ✅ 完整 | ⚠️ 基础 | ✅ 完整 |
| 路由信息 | ✅ 完整 | ❌ 不支持 | ✅ 完整 |
| 子网计算器 | ✅ 完整 | ✅ 完整 | ✅ 完整 |

**交付时间：** 4-5 周（调整 +1 周用于 DoH 实现）

---

### v0.3.0 - 高级诊断 📊 优先级：P1
**目标：** 提供专业级网络分析工具  
**风险控制：** 明确平台限制，提供降级方案

#### 新增功能

##### 端口扫描 🔍 跨平台可行，注意能耗
- [ ] **IPv6 端口扫描器**
  - TCP Connect 扫描（所有平台）
  - 并发控制与速率限制（移动端 10 并发，桌面 50 并发）
  - 超时策略（移动端 2s，桌面 5s）

- [ ] **常用端口预设**（HTTP/HTTPS/SSH/FTP/DNS 等）
- [ ] **扫描结果报告**（开放端口、服务识别）
- [ ] **服务识别**（Banner Grabbing，可选）

- [ ] **平台限制处理**
  - **iOS：** ⚠️ 仅前台扫描，后台 30 秒限制，能耗警告
  - **Android：** 完整支持，注意电池优化
  - **Desktop：** 完整支持

##### Whois 查询 🌍 外部 API 集成
- [ ] **IPv6 地址 Whois 查询**
  - 使用公共 Whois 服务（ARIN/RIPE/APNIC）
  - 缓存机制（SQLDelight）
  - 离线模式提示

- [ ] **ASN 信息查询**
  - BGP.tools API 或 IPinfo API
  - 隐私模式：可选禁用远程查询

- [ ] **地理位置信息**（IP 归属地，城市级别）
  - **隐私说明：** 在 UI 明确告知使用第三方 API

##### MTU 探测 📏 启发式实现
- [ ] **Path MTU Discovery（启发式）**
  - ⚠️ **跨平台限制：** 无法直接控制 DF 位与分片
  - **实现方案：** 二分探测法（发送不同大小数据包，根据超时推断）
  - **平台差异：**
    - Android/Desktop：使用 UDP/TCP 包大小探测
    - iOS：仅 TCP 探测，精度较低

- [ ] **分片测试**（理论值计算 + 实测对比）
- [ ] **MTU 优化建议**（基于探测结果）
- [ ] **平台限制说明**（UI 中注明非精确测量）

##### 性能测试 ⚡ 基础实现
- [ ] **网络延迟测试**
  - 到公共端点（Google DNS, Cloudflare DNS）的 RTT
  - 统计：最小/平均/最大/标准差

- [ ] **带宽测试（基础）**
  - ⚠️ **粗略估计：** 下载公共文件测速
  - **隐私：** 可选功能，明确告知数据传输

- [ ] **丢包率统计**（基于连续 Ping）

**平台功能覆盖矩阵：**
| 功能 | Android | iOS | Desktop |
|------|---------|-----|---------|
| 端口扫描 | ✅ 完整 | ⚠️ 前台限制 | ✅ 完整 |
| Whois 查询 | ✅ 完整 | ✅ 完整 | ✅ 完整 |
| MTU 探测 | ✅ 启发式 | ⚠️ 低精度 | ✅ 启发式 |
| 性能测试 | ✅ 完整 | ✅ 完整 | ✅ 完整 |

**交付时间：** 5-6 周（调整 +1 周用于 iOS 适配）

---

### v0.4.0 - 实用工具与集成 🛠️ 优先级：P1
**目标：** 增强用户体验和实用性

#### 新增功能

##### 地址生成器 🎲 跨平台完整支持
- [ ] 随机 IPv6 地址生成（符合 RFC 规范）
- [ ] MAC 地址到 IPv6 转换（SLAAC EUI-64）
- [ ] ULA 地址生成器（fc00::/7 范围）
- [ ] 批量地址生成（导出为列表）

##### 协议分析 📦 拆分实现
- [ ] **离线解析器**（v0.4.0 实现）
  - 导入 ICMPv6/NDP/RA 报文文本或 pcap 文件
  - 解析并可视化展示
  - 静态示例报文库（教学用途）

- [ ] **在线抓包与解析**（延期至 v1.1+）
  - ⚠️ **高风险：** 需要 root/管理员权限或平台 API 限制
  - **Android：** VpnService API（需用户授权）
  - **iOS：** ❌ 不支持（沙箱限制）
  - **Desktop：** libpcap/WinPcap（需管理员权限）

##### 数据导入/导出 📤 跨平台适配
- [ ] **导出测试结果**
  - JSON/CSV/TXT 格式
  - 包含时间戳、元数据

- [ ] **批量导入地址列表**（CSV/TXT）
- [ ] **分享功能**
  - **Android：** ShareSheet API
  - **iOS：** UIActivityViewController
  - **Desktop：** 文件保存对话框

##### 网络配置助手 📖 文档化实现
- [ ] **IPv6 配置向导**（图文教程）
- [ ] **双栈配置建议**（检测当前环境）
- [ ] **隧道配置指南**（6to4、6in4、Teredo）
  - ⚠️ **不执行系统配置修改**，仅提供指导

**平台功能覆盖矩阵：**
| 功能 | Android | iOS | Desktop |
|------|---------|-----|---------|
| 地址生成器 | ✅ 完整 | ✅ 完整 | ✅ 完整 |
| 离线协议分析 | ✅ 完整 | ✅ 完整 | ✅ 完整 |
| 在线抓包 | ⏳ v1.1+ | ❌ 不支持 | ⏳ v1.1+ |
| 导入/导出 | ✅ 完整 | ✅ 完整 | ✅ 完整 |
| 配置向导 | ✅ 完整 | ✅ 完整 | ✅ 完整 |

**交付时间：** 3-4 周

---

### v0.5.0 - 监控与自动化 📈 优先级：P2
**目标：** 提供持续监控和自动化功能  
**平台差异化：** 移动端受限，桌面端完整

#### 新增功能

##### 网络监控 📊 平台差异显著
- [ ] **IPv6 连接性监控**
  - **Android：** WorkManager 定期任务 + 前台服务
  - **iOS：** ⚠️ **仅前台监控** + 后台刷新（间隔 15 分钟+）
  - **Desktop：** 完整后台监控

- [ ] **实时带宽监控**
  - **Android/Desktop：** 完整支持
  - **iOS：** ⚠️ 仅前台

- [ ] **连接质量评分**（延迟/丢包/抖动综合评估）
- [ ] **告警通知**
  - **Android：** 系统通知
  - **iOS：** 本地通知（有限）
  - **Desktop：** 系统托盘通知

##### 定时任务 ⏰ 平台限制
- [ ] **定时 Ping 监控**
  - **Android：** AlarmManager + WorkManager
  - **iOS：** ⚠️ 后台刷新（不保证精确）
  - **Desktop：** 精确定时器

- [ ] **定时 DNS 检查**
- [ ] **监控报告生成**（导出为 PDF/HTML）

##### 脚本与自动化 🤖 平台选择性支持
- [ ] **简单脚本支持**
  - **Android/Desktop：** 嵌入 Lua 或 JavaScript 引擎
  - **iOS：** ❌ **暂不支持**（审核风险），仅提供模板化流水线

- [ ] **批量操作工具**（所有平台）
- [ ] **自定义工具流水线**（拖拽式，无代码）

##### 云同步 ☁️ 降级实现
- [ ] **配置导出/导入**（本地文件）
- [ ] **手动云盘同步引导**（iCloud/Google Drive/OneDrive）
- [ ] ⚠️ **暂不实现账号体系**（避免隐私合规复杂性）

**平台功能覆盖矩阵：**
| 功能 | Android | iOS | Desktop |
|------|---------|-----|---------|
| 后台监控 | ✅ 完整 | ⚠️ 间隔 15min+ | ✅ 完整 |
| 实时带宽监控 | ✅ 完整 | ⚠️ 仅前台 | ✅ 完整 |
| 告警通知 | ✅ 完整 | ⚠️ 本地通知 | ✅ 完整 |
| 定时任务 | ✅ 完整 | ⚠️ 后台刷新 | ✅ 完整 |
| 脚本引擎 | ✅ Lua/JS | ❌ 不支持 | ✅ Lua/JS |
| 云同步 | ⏳ 手动 | ⏳ 手动 | ⏳ 手动 |

**交付时间：** 6-7 周（调整 +1 周用于平台限制处理）

---

### v0.6.0 - 教育与社区 📚 优先级：P2
**目标：** 帮助用户学习 IPv6 知识  
**跨平台完整支持**

#### 新增功能

##### 学习中心 📖 内容驱动
- [ ] **IPv6 基础知识库**
  - 地址格式、类型、前缀
  - 协议栈（ICMPv6、NDP、DHCPv6）
  - 双栈与过渡技术

- [ ] **交互式教程**（Compose 原生实现）
  - 地址压缩练习
  - 子网划分模拟器
  - Ping/DNS 实战演练

- [ ] **常见问题解答**（FAQ）
- [ ] **最佳实践指南**（家庭/企业网络）

##### 工具提示 💡 用户引导
- [ ] **内联帮助文档**（工具页内嵌）
- [ ] **新手引导**（首次启动 Onboarding）
- [ ] **工具使用技巧**（Tips of the Day）

##### 诊断报告 📄 自动化分析
- [ ] **网络健康诊断**
  - 自动检测 IPv6 连接性
  - DNS 解析健康度
  - 网络配置建议

- [ ] **问题分析与建议**
  - 常见错误诊断（无 IPv6、DNS 故障）
  - 优化建议（MTU、DNS 服务器）

- [ ] **可读性强的报告生成**
  - Markdown/HTML/PDF 导出
  - 多语言支持

**交付时间：** 3-4 周

---

### v1.0.0 - 正式版 🚀 优先级：P3
**目标：** 完善功能，优化体验，准备发布

#### 完善项

##### 性能优化 ⚡
- [ ] 启动速度优化（< 2 秒冷启动）
- [ ] 内存占用优化（常驻 < 50MB）
- [ ] 网络请求优化（连接池、缓存）
- [ ] 动画流畅度优化（60fps）

##### 多语言支持 🌍
- [ ] 简体中文（zh-CN）
- [ ] 繁体中文（zh-TW）
- [ ] 英语（en）
- [ ] 日语（ja）

##### 无障碍支持 ♿
- [ ] 屏幕阅读器支持（TalkBack/VoiceOver）
- [ ] 高对比度主题
- [ ] 字体大小调整（系统设置跟随）
- [ ] 键盘导航（Desktop）

##### 稳定性与测试 🧪 分层目标
- [ ] **单元测试覆盖率**
  - domain/commonMain: > 80%
  - data/repositories: > 70%
  - 平台层：以集成测试为主

- [ ] **UI 自动化测试**（关键流程）
- [ ] **跨平台兼容性测试**
  - Android 7.0 - 15
  - iOS 14 - 18
  - Windows 10/11, macOS 12+, Ubuntu 20.04+

- [ ] **性能基准测试**
  - 启动时间、内存占用、网络延迟

##### 发布准备 📦
- [ ] **应用商店素材**
  - 图标、截图、宣传视频
  - 应用描述（多语言）

- [ ] **用户文档**
  - 快速入门指南
  - 功能详解
  - 故障排查

- [ ] **隐私政策与使用条款**
  - **关键内容：** 网络诊断数据处理、外部 API 使用（Whois/ASN/Geo）、日志收集、崩溃报告
  - 符合 GDPR/CCPA 要求

- [ ] **崩溃报告系统**
  - Sentry/Firebase Crashlytics
  - 匿名化处理

**交付时间：** 6-8 周

---

## 后续版本规划（v1.1.0+）

### 高级功能（按优先级排序）

#### 1. 网络抓包功能（P2，v1.1.0）
- **在线数据包捕获**
  - **Android：** VpnService API（需用户授权）
  - **iOS：** ❌ 不支持（沙箱限制）
  - **Desktop：** libpcap/WinPcap（需管理员权限）

- **IPv6 流量分析**
- **数据包过滤**（BPF 语法）

#### 2. iOS Traceroute 实现（P1，v1.2.0）
- 使用 UDP/ICMP 混合策略
- 需研究 Network.framework 能力

#### 3. VPN/隧道工具（P2，v1.3.0）
- VPN 连接测试
- 隧道配置助手
- Teredo/ISATAP 诊断

#### 4. 企业功能（P3，v2.0.0）
- 批量设备管理
- 网络拓扑可视化
- 团队协作功能

#### 5. API 集成（P3，v2.1.0）
- RESTful API 提供
- Webhook 支持
- 第三方工具集成

---

## 技术债务管理

### 持续改进项
- **代码质量**
  - PR 必须通过 Code Review
  - 定期重构（每季度一次）
  - Ktlint/Detekt 静态分析

- **文档维护**
  - API 文档（KDoc）
  - 架构决策记录（ADR）
  - 开发指南更新

- **依赖更新**
  - Kotlin/Compose 每 6 个月跟进
  - 安全补丁及时更新
  - 弃用 API 迁移

---

## 工程配套清单

### 必须建立的模块与文档
- [ ] **core-network 模块**（commonMain + 平台实现）
- [ ] **platform-capabilities.md**（能力矩阵与权限需求）
- [ ] **每功能 PR 附平台可行性说明**

### 依赖基线
- [ ] SQLDelight（数据持久化）
- [ ] Ktor Client（网络请求，含 DoH）
- [ ] Kotlinx Serialization（JSON 解析）

### 测试工具
- [ ] kotlin-test + kotlinx-coroutines-test
- [ ] Turbine（Flow 测试）
- [ ] MockK（Mock 框架）

### 合规与发布
- [ ] 隐私政策模板（覆盖网络诊断、外部 API、日志）
- [ ] 能耗与后台运行指引（Android/iOS 平台特定）
- [ ] 崩溃报告与匿名化策略

---

## 优先级说明
- **P0（必须）：** 核心功能，MVP 必备，影响产品可用性
- **P1（重要）：** 重要功能，提升产品竞争力
- **P2（建议）：** 增值功能，提升用户体验
- **P3（可选）：** 锦上添花，可延后实现

---

## 发布节奏
- **Alpha 版本：** 每 2 周发布一次（内部测试）
- **Beta 版本：** 每月发布一次（公开测试）
- **正式版本：** 每季度一个大版本

---

## 平台优先级与策略
1. **Android**（P0）- 最大用户群，功能最完整
2. **Desktop (Windows/Linux/macOS)**（P0）- 专业用户，功能完整
3. **iOS**（P1）- 重要市场，但功能受限，优先保证核心体验

**iOS 降级策略：**
- 无法实现的功能明确标注"平台不支持"
- 提供替代方案（如 TCP 探测替代 ICMP）
- 在 UI 中展示功能限制说明

---

## 成功指标（调整）
- **v0.1.0：** 基础架构完成，Android + Desktop 可用，3 个核心工具
- **v0.3.0：** 工具集达到 8+ 个（考虑平台差异），内测用户 > 50
- **v1.0.0：** 应用商店评分 > 4.3（考虑 iOS 功能限制），月活 > 5,000

---

## 反馈与迭代
- **GitHub Issues：** 功能需求与 Bug 跟踪
- **用户调研：** 每月进行（Alpha/Beta 阶段）
- **路线图动态调整：** 根据平台限制与用户反馈及时优化

---

## 图例说明
- ✅ **完整支持** - 功能完整，无明显限制
- ⚠️ **受限支持** - 功能可用，但有平台限制
- ❌ **不支持** - 平台技术限制，无法实现
- ⏳ **计划中** - 后续版本支持

---

**文档版本：** 2.0（基于 GPT-5 反馈优化）  
**最后更新：** 2025-10-26  
**维护者：** IPv6 Toolbox Team  
